mqtt:
  name: sxvrs_daemon
  topic_publish  : sxvrs/clients/{source_name}
  topic_subscribe: sxvrs/daemon/{source_name}
  server_ip: 127.0.0.1
  server_port: 1883
  server_keepalive: 60
  login:
  pwd:

temp_storage_path: /dev/shm/sxvrs # folder where RAM disk will be mounted
temp_storage_size: 128 # Size of the RAM disk in MB
temp_storage_cmd_mount: mkdir {temp_storage_path}; mount -t tmpfs -o size={temp_storage_size}m tmpfs {temp_storage_path}
temp_storage_cmd_unmount: umount {path}
  
global:
  record_autostart: False
  ip: 127.0.0.1
  stream_url: "rtsp://{ip}:5544/live0.264"
  record_time: 30 # Seconds
  storage_max_size: 10 # GBytes
  storage_path: storage/{name}
  filename_temp: "{storage_path}/{name}_{datetime:%H%M%S.%f}"
  filename_snapshot: "{storage_path}/snapshot.jpg"
  filename_video: "{storage_path}/{datetime:%Y-%m-%d}/{name}_{datetime:%Y%m%d_%H%M%S}.mp4"
  cmd_ffmpeg_read: "ffmpeg -hide_banner -nostdin -nostats -fflags nobuffer -flags low_delay -fflags +genpts+discardcorrupt -y -i {stream_url} -f rawvideo -pix_fmt rgb24 pipe:"
  cmd_ffmpeg_write: 'ffmpeg -hide_banner -nostdin -nostats -y -f rawvideo -vcodec rawvideo -s {width}x{height} -pix_fmt rgb{pixbytes} -r {pixbytes} -i - -an -vcodec mpeg4 "{filename}"'
  start_error_atempt_cnt: 10 # If process will not able to start for this number attempts, then it will go to sleep
  start_error_threshold: 10 # Minimum number of seconds, to understand that process is started normally
  start_error_sleep: 600 # Number of seconds to sleep on error
  frame_skip: 5 # How many frames will be scipped between motion detection
  throtling_min_mem_size: 5 # [MB] if on RAM disk there will be too many files, then start to increase frame skiping
  throtling_max_mem_size: 10 # [MB] if total size of files exceeds maximum value, then dissable frame saving to RAM folder
  motion_detector:    
    max_image_width: 400 # If image bigger in width, it will be resized to this size. Default value is 300
    max_image_height: 300 # If image bigger in width, it will be resized to this size. Default value is 300
    # bg_frame_count: 5 # number of frames to remember for the background (selected randomly)
    # motion_detector_threshold: 15 # threshold for binarizing image difference in motion detector
    # If defined <contour_detection> then it will try to detect motion by detecting contours inside the frame (slightly cpu expensive operation)
    contour_detection:
      min_area: 0.3% # to trigger motion event, motion contour area must have minimum size
      max_area: 50% # if changes are too big (i.e. all image is changed) then ignore it
      max_count: 15 # if there are too many counturs, than there is an interference (such as rain, snow etc..)
    detect_by_diff_threshold: 1.5 # if <contour_detection> is not enabled, then trigger detect event by difference threshold
    min_frames_changes: 3 # min_frames_changes: 4 - how many frames must be changed, before triggering for the montion start
    max_frames_static: 2 # max_frames_static: 2 - how many frames must be static, before assume that there is no motion anymore
    #filename_debug:


recorders:
  camera_1: #Source name
    record_autostart: True
    ip: 192.168.1.10
    storage_max_size: 1 #GB
    stream_url: rtsp://wowzaec2demo.streamlock.net/vod/mp4:BigBuckBunny_115k.mov


logger:
  version: 1
  disable_existing_loggers: False
  formatters:
      simple:
          format: "%(asctime)s - %(name)s [%(levelname)s]: \t %(message)s"
  handlers:
      console:
          class: logging.StreamHandler
          level: DEBUG
          formatter: simple
          stream: ext://sys.stdout

      info_file_handler:
          class: logging.handlers.RotatingFileHandler
          level: INFO
          formatter: simple
          filename: logs/sxvrs_daemon.log
          maxBytes: 10485760 # 10MB
          backupCount: 10
          encoding: utf8

      error_file_handler:
          class: logging.handlers.RotatingFileHandler
          level: ERROR
          formatter: simple
          filename: logs/sxvrs_daemon.err
          maxBytes: 10485760 # 10MB
          backupCount: 10
          encoding: utf8

  root:
      level: DEBUG
      handlers: [console, info_file_handler, error_file_handler]